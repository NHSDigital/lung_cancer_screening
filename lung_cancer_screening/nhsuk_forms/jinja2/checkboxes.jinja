{% from 'nhsuk/components/checkboxes/macro.jinja' import checkboxes %}
{% set unbound_field = field.field %}
{% if field.errors %}
  {% set error_message = {"text": field.errors | first} %}
{% endif %}
{% set ns = namespace(items=[]) %}
{% for value, text in unbound_field.choices %}
  {% set hint_text = field.get_hint_for_choice(value) %}
  {% set ns.items = ns.items + [{
    "id": field.auto_id ~ '_' ~ loop.index0,
    "value": value,
    "text": text,
    "checked": value in (field.value() or []),
    "hint": {
      "text": hint_text
    } if hint_text else undefined
  }] %}
  {% set divider = field.get_divider_after(value) %}
  {% if divider %}
    {% set ns.items = ns.items + [{"divider": divider}] %}
  {% endif %}
{% endfor %}
{{ checkboxes({
  "name": field.html_name,
  "idPrefix": field.auto_id,
  "fieldset": {
    "legend": {
      "text": field.label,
      "classes": unbound_field.label_classes,
      "isPageHeading": unbound_field.label_is_page_heading
    }
  } if field.use_fieldset else none,
  "errorMessage": error_message,
  "classes": unbound_field.classes if unbound_field.classes,
  "hint": {
    "html": unbound_field.hint|e
  } if unbound_field.hint,
  "items": ns.items
}) }}
